{"version":3,"file":"amll-react.js","sources":["../src/bg-render.tsx","../src/lyric-player.tsx"],"sourcesContent":["import {\n\ttype AbstractBaseRenderer,\n\ttype BaseRenderer,\n\tBackgroundRender as CoreBackgroundRender,\n\tMeshGradientRenderer,\n} from \"@applemusic-like-lyrics/core\";\nimport {\n\ttype HTMLProps,\n\tforwardRef,\n\tuseEffect,\n\tuseImperativeHandle,\n\tuseRef,\n} from \"react\";\nexport {\n\tBaseRenderer,\n\tMeshGradientRenderer,\n\tPixiRenderer,\n} from \"@applemusic-like-lyrics/core\";\n\n/**\n * 背景渲染组件的属性\n */\nexport interface BackgroundRenderProps {\n\t/**\n\t * 设置背景专辑资源\n\t */\n\talbum?: string | HTMLImageElement | HTMLVideoElement;\n\t/**\n\t * 设置专辑资源是否为视频\n\t */\n\talbumIsVideo?: boolean;\n\t/**\n\t * 设置当前背景动画帧率，如果为 `undefined` 则默认为 `30`\n\t */\n\tfps?: number;\n\t/**\n\t * 设置当前播放状态，如果为 `undefined` 则默认为 `true`\n\t */\n\tplaying?: boolean;\n\t/**\n\t * 设置当前动画流动速度，如果为 `undefined` 则默认为 `2`\n\t */\n\tflowSpeed?: number;\n\t/**\n\t * 设置背景是否根据“是否有歌词”这个特征调整自身效果，例如有歌词时会变得更加活跃\n\t *\n\t * 部分渲染器会根据这个特征调整自身效果\n\t *\n\t * 如果不确定是否需要赋值或无法知晓是否包含歌词，请传入 true 或不做任何处理（默认值为 true）\n\t */\n\thasLyric?: boolean;\n\t/**\n\t * 设置低频的音量大小，范围在 80hz-120hz 之间为宜，取值范围在 [0.0-1.0] 之间\n\t *\n\t * 部分渲染器会根据音量大小调整背景效果（例如根据鼓点跳动）\n\t *\n\t * 如果无法获取到类似的数据，请传入 undefined 或 1.0 作为默认值，或不做任何处理（默认值即 1.0）\n\t */\n\tlowFreqVolume?: number;\n\t/**\n\t * 设置当前渲染缩放比例，如果为 `undefined` 则默认为 `0.5`\n\t */\n\trenderScale?: number;\n\t/**\n\t * 是否启用静态模式，即图片在更换后就会保持静止状态并禁用更新，以节省性能\n\t * 默认为 `false`\n\t */\n\tstaticMode?: boolean;\n\t/**\n\t * 设置渲染器，如果为 `undefined` 则默认为 `PixiRenderer`\n\t * 默认渲染器有可能会随着版本更新而更换\n\t */\n\trenderer?: {\n\t\tnew (...args: ConstructorParameters<typeof BaseRenderer>): BaseRenderer;\n\t};\n}\n\n/**\n * 背景渲染组件的引用\n */\nexport interface BackgroundRenderRef {\n\t/**\n\t * 背景渲染实例引用\n\t */\n\tbgRender?: AbstractBaseRenderer;\n\t/**\n\t * 将背景渲染实例的元素包裹起来的 DIV 元素实例\n\t */\n\twrapperEl: HTMLDivElement | null;\n}\n\n/**\n * 流体背景渲染组件，通过提供图片链接可以显示出酷似 Apple Music 的流体背景效果\n */\nexport const BackgroundRender = forwardRef<\n\tBackgroundRenderRef,\n\tHTMLProps<HTMLDivElement> & BackgroundRenderProps\n>(\n\t(\n\t\t{\n\t\t\talbum,\n\t\t\talbumIsVideo,\n\t\t\tfps,\n\t\t\tplaying,\n\t\t\tflowSpeed,\n\t\t\trenderScale,\n\t\t\tstaticMode,\n\t\t\tlowFreqVolume,\n\t\t\thasLyric,\n\t\t\trenderer,\n\t\t\tstyle,\n\t\t\t...props\n\t\t},\n\t\tref,\n\t) => {\n\t\tconst coreBGRenderRef = useRef<AbstractBaseRenderer>(null);\n\t\tconst wrapperRef = useRef<HTMLDivElement>(null);\n\t\tconst lastRendererRef = useRef<{\n\t\t\tnew (canvas: HTMLCanvasElement): BaseRenderer;\n\t\t}>(null);\n\t\tconst curRenderer = renderer ?? MeshGradientRenderer;\n\n\t\tuseEffect(() => {\n\t\t\tif (\n\t\t\t\tlastRendererRef.current !== curRenderer ||\n\t\t\t\tcoreBGRenderRef.current === undefined\n\t\t\t) {\n\t\t\t\tlastRendererRef.current = curRenderer;\n\t\t\t\tcoreBGRenderRef.current?.dispose();\n\t\t\t\tcoreBGRenderRef.current = CoreBackgroundRender.new(curRenderer);\n\t\t\t}\n\t\t}, [curRenderer]);\n\n\t\tuseEffect(() => {\n\t\t\tif (curRenderer && album)\n\t\t\t\tcoreBGRenderRef.current?.setAlbum(album, albumIsVideo);\n\t\t}, [curRenderer, album, albumIsVideo]);\n\n\t\tuseEffect(() => {\n\t\t\tif (curRenderer && fps) coreBGRenderRef.current?.setFPS(fps);\n\t\t}, [curRenderer, fps]);\n\n\t\tuseEffect(() => {\n\t\t\tif (!curRenderer) return;\n\t\t\tif (playing === undefined) {\n\t\t\t\tcoreBGRenderRef.current?.resume();\n\t\t\t} else if (playing) {\n\t\t\t\tcoreBGRenderRef.current?.resume();\n\t\t\t} else {\n\t\t\t\tcoreBGRenderRef.current?.pause();\n\t\t\t}\n\t\t}, [curRenderer, playing]);\n\n\t\tuseEffect(() => {\n\t\t\tif (!curRenderer) return;\n\t\t\tif (flowSpeed) coreBGRenderRef.current?.setFlowSpeed(flowSpeed);\n\t\t}, [curRenderer, flowSpeed]);\n\n\t\tuseEffect(() => {\n\t\t\tif (!curRenderer) return;\n\t\t\tcoreBGRenderRef.current?.setStaticMode(staticMode ?? false);\n\t\t}, [curRenderer, staticMode]);\n\n\t\tuseEffect(() => {\n\t\t\tif (curRenderer && renderScale)\n\t\t\t\tcoreBGRenderRef.current?.setRenderScale(renderScale ?? 0.5);\n\t\t}, [curRenderer, renderScale]);\n\n\t\tuseEffect(() => {\n\t\t\tif (curRenderer && lowFreqVolume)\n\t\t\t\tcoreBGRenderRef.current?.setLowFreqVolume(lowFreqVolume ?? 1.0);\n\t\t}, [curRenderer, lowFreqVolume]);\n\n\t\tuseEffect(() => {\n\t\t\tif (curRenderer && hasLyric !== undefined)\n\t\t\t\tcoreBGRenderRef.current?.setHasLyric(hasLyric ?? true);\n\t\t}, [curRenderer, hasLyric]);\n\n\t\t// biome-ignore lint/correctness/useExhaustiveDependencies: coreBGRenderRef.current\n\t\tuseEffect(() => {\n\t\t\tif (coreBGRenderRef.current) {\n\t\t\t\tconst el = coreBGRenderRef.current.getElement();\n\t\t\t\tel.style.width = \"100%\";\n\t\t\t\tel.style.height = \"100%\";\n\t\t\t\tel.style.minHeight = \"0\";\n\t\t\t\tel.style.minWidth = \"0\";\n\t\t\t\tel.style.overflow = \"hidden\";\n\t\t\t\twrapperRef.current?.appendChild(el);\n\t\t\t}\n\t\t}, [coreBGRenderRef.current]);\n\n\t\t// biome-ignore lint/correctness/useExhaustiveDependencies: wrapperRef.current, coreBGRenderRef.current\n\t\tuseImperativeHandle(\n\t\t\tref,\n\t\t\t() => ({\n\t\t\t\twrapperEl: wrapperRef.current,\n\t\t\t\tbgRender: coreBGRenderRef.current!,\n\t\t\t}),\n\t\t\t[wrapperRef.current, coreBGRenderRef.current],\n\t\t);\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tstyle={{\n\t\t\t\t\tdisplay: \"contents\",\n\t\t\t\t\t...style,\n\t\t\t\t}}\n\t\t\t\t{...props}\n\t\t\t\tref={wrapperRef}\n\t\t\t/>\n\t\t);\n\t},\n);\n","import type {\n\tLyricLine,\n\tLyricLineMouseEvent,\n\tLyricPlayerBase,\n\tspring,\n} from \"@applemusic-like-lyrics/core\";\nimport { LyricPlayer as DefaultLyricPlayer } from \"@applemusic-like-lyrics/core\";\nimport {\n\ttype HTMLProps,\n\tforwardRef,\n\tuseEffect,\n\tuseImperativeHandle,\n\tuseLayoutEffect,\n\tuseRef,\n\tuseState,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\n\n/**\n * 歌词播放组件的属性\n */\nexport interface LyricPlayerProps {\n\t/**\n\t * 是否禁用歌词播放组件，默认为 `false`，歌词组件启用后将会开始逐帧更新歌词的动画效果，并对传入的其他参数变更做出反馈。\n\t *\n\t * 如果禁用了歌词组件动画，你也可以通过引用取得原始渲染组件实例，手动逐帧调用其 `update` 函数来更新动画效果。\n\t */\n\tdisabled?: boolean;\n\t/**\n\t * 是否演出部分效果，目前会控制播放间奏点的动画的播放暂停与否，默认为 `true`\n\t */\n\tplaying?: boolean;\n\t/**\n\t * 设置歌词行的对齐方式，如果为 `undefined` 则默认为 `center`\n\t *\n\t * - 设置成 `top` 的话将会向目标歌词行的顶部对齐\n\t * - 设置成 `bottom` 的话将会向目标歌词行的底部对齐\n\t * - 设置成 `center` 的话将会向目标歌词行的垂直中心对齐\n\t */\n\talignAnchor?: \"top\" | \"bottom\" | \"center\";\n\t/**\n\t * 设置默认的歌词行对齐位置，相对于整个歌词播放组件的大小位置，如果为 `undefined`\n\t * 则默认为 `0.5`\n\t *\n\t * 可以设置一个 `[0.0-1.0]` 之间的任意数字，代表组件高度由上到下的比例位置\n\t */\n\talignPosition?: number;\n\t/**\n\t * 设置是否使用物理弹簧算法实现歌词动画效果，默认启用\n\t *\n\t * 如果启用，则会通过弹簧算法实时处理歌词位置，但是需要性能足够强劲的电脑方可流畅运行\n\t *\n\t * 如果不启用，则会回退到基于 `transition` 的过渡效果，对低性能的机器比较友好，但是效果会比较单一\n\t */\n\tenableSpring?: boolean;\n\t/**\n\t * 设置是否启用歌词行的模糊效果，默认为 `true`\n\t */\n\tenableBlur?: boolean;\n\t/**\n\t * 设置是否使用物理弹簧算法实现歌词动画效果，默认启用\n\t *\n\t * 如果启用，则会通过弹簧算法实时处理歌词位置，但是需要性能足够强劲的电脑方可流畅运行\n\t *\n\t * 如果不启用，则会回退到基于 `transition` 的过渡效果，对低性能的机器比较友好，但是效果会比较单一\n\t */\n\tenableScale?: boolean;\n\t/**\n\t * 设置是否隐藏已经播放过的歌词行，默认不隐藏\n\t */\n\thidePassedLines?: boolean;\n\t/**\n\t * 设置当前播放歌词，要注意传入后这个数组内的信息不得修改，否则会发生错误\n\t */\n\tlyricLines?: LyricLine[];\n\t/**\n\t * 设置当前播放进度，单位为毫秒且**必须是整数**，此时将会更新内部的歌词进度信息\n\t * 内部会根据调用间隔和播放进度自动决定如何滚动和显示歌词，所以这个的调用频率越快越准确越好\n\t */\n\tcurrentTime?: number;\n\tisSeeking?: boolean;\n\t/**\n\t * 设置文字动画的渐变宽度，单位以歌词行的主文字字体大小的倍数为单位，默认为 0.5，即一个全角字符的一半宽度\n\t *\n\t * 如果要模拟 Apple Music for Android 的效果，可以设置为 1\n\t *\n\t * 如果要模拟 Apple Music for iPad 的效果，可以设置为 0.5\n\t *\n\t * 如果想要近乎禁用渐变效果，可以设置成非常接近 0 的小数（例如 `0.0001` ），但是**不可以为 0**\n\t */\n\twordFadeWidth?: number;\n\t/**\n\t * 设置所有歌词行在横坐标上的弹簧属性，包括重量、弹力和阻力。\n\t *\n\t * @param params 需要设置的弹簧属性，提供的属性将会覆盖原来的属性，未提供的属性将会保持原样\n\t */\n\tlinePosXSpringParams?: Partial<spring.SpringParams>;\n\t/**\n\t * 设置所有歌词行在​纵坐标上的弹簧属性，包括重量、弹力和阻力。\n\t *\n\t * @param params 需要设置的弹簧属性，提供的属性将会覆盖原来的属性，未提供的属性将会保持原样\n\t */\n\tlinePosYSpringParams?: Partial<spring.SpringParams>;\n\t/**\n\t * 设置所有歌词行在​缩放大小上的弹簧属性，包括重量、弹力和阻力。\n\t *\n\t * @param params 需要设置的弹簧属性，提供的属性将会覆盖原来的属性，未提供的属性将会保持原样\n\t */\n\tlineScaleSpringParams?: Partial<spring.SpringParams>;\n\t/**\n\t * 在一个特殊的底栏元素内加入指定元素，默认是空白的，可以往内部添加任意元素\n\t *\n\t * 这个元素始终在歌词的底部，可以用于显示歌曲创作者等信息\n\t */\n\tbottomLine?: Parameters<typeof createPortal>[0];\n\t/**\n\t * 需要用于创建歌词播放组件的类实例\n\t */\n\tlyricPlayer?: {\n\t\tnew (\n\t\t\t...args: ConstructorParameters<typeof LyricPlayerBase>\n\t\t): LyricPlayerBase;\n\t};\n\t/**\n\t * 当某个歌词行被左键点击时触发的事件\n\t * @param line 歌词行的事件对象，可以访问到对应的歌词行信息和歌词行索引\n\t */\n\tonLyricLineClick?: (line: LyricLineMouseEvent) => void;\n\t/**\n\t * 当某个歌词行被右键点击时触发的事件\n\t * @param line 歌词行的事件对象，可以访问到对应的歌词行信息和歌词行索引\n\t */\n\tonLyricLineContextMenu?: (line: LyricLineMouseEvent) => void;\n}\n\n/**\n * 歌词播放组件的引用\n */\nexport interface LyricPlayerRef {\n\t/**\n\t * 歌词播放实例\n\t */\n\tlyricPlayer?: LyricPlayerBase;\n\t/**\n\t * 将歌词播放实例的元素包裹起来的 DIV 元素实例\n\t */\n\twrapperEl: HTMLDivElement | null;\n}\n\n/**\n * 歌词播放组件，本框架的核心组件\n *\n * 尽可能贴切 Apple Music for iPad 的歌词效果设计，且做了力所能及的优化措施\n */\nexport const LyricPlayer = forwardRef<\n\tLyricPlayerRef,\n\tHTMLProps<HTMLDivElement> & LyricPlayerProps\n>(\n\t(\n\t\t{\n\t\t\tdisabled,\n\t\t\tplaying,\n\t\t\talignAnchor,\n\t\t\talignPosition,\n\t\t\tenableSpring,\n\t\t\tenableBlur,\n\t\t\tenableScale,\n\t\t\thidePassedLines,\n\t\t\tlyricLines,\n\t\t\tcurrentTime,\n\t\t\tisSeeking,\n\t\t\twordFadeWidth,\n\t\t\tlinePosXSpringParams,\n\t\t\tlinePosYSpringParams,\n\t\t\tlineScaleSpringParams,\n\t\t\tbottomLine,\n\t\t\tlyricPlayer,\n\t\t\tonLyricLineClick,\n\t\t\tonLyricLineContextMenu,\n\t\t\t...props\n\t\t},\n\t\tref,\n\t) => {\n\t\t// const corePlayerRef = useRef<LyricPlayerBase>();\n\t\tconst [corePlayer, setCorePlayer] = useState<LyricPlayerBase>();\n\t\tconst wrapperRef = useRef<HTMLDivElement>(null);\n\t\tconst currentTimeRef = useRef(currentTime);\n\n\t\tuseLayoutEffect(() => {\n\t\t\tconst newPlayer = new (lyricPlayer ?? DefaultLyricPlayer)();\n\t\t\tsetCorePlayer(newPlayer);\n\t\t\twrapperRef.current?.appendChild(newPlayer.getElement());\n\t\t\treturn () => {\n\t\t\t\tnewPlayer?.dispose();\n\t\t\t\tsetCorePlayer(undefined);\n\t\t\t};\n\t\t}, [lyricPlayer]);\n\n\t\tuseLayoutEffect(() => {\n\t\t\tif (lyricLines !== undefined) {\n\t\t\t\tcorePlayer?.setLyricLines(lyricLines, currentTimeRef.current);\n\t\t\t\tcorePlayer?.update();\n\t\t\t} else {\n\t\t\t\tcorePlayer?.setLyricLines([]);\n\t\t\t\tcorePlayer?.update();\n\t\t\t}\n\t\t}, [corePlayer, lyricLines]);\n\n\t\tuseEffect(() => {\n\t\t\tif (!disabled) {\n\t\t\t\tlet canceled = false;\n\t\t\t\tlet lastTime = -1;\n\t\t\t\tconst onFrame = (time: number) => {\n\t\t\t\t\tif (canceled) return;\n\t\t\t\t\tif (lastTime === -1) {\n\t\t\t\t\t\tlastTime = time;\n\t\t\t\t\t}\n\t\t\t\t\tcorePlayer?.update(time - lastTime);\n\t\t\t\t\tlastTime = time;\n\t\t\t\t\trequestAnimationFrame(onFrame);\n\t\t\t\t};\n\t\t\t\tcorePlayer?.calcLayout();\n\t\t\t\trequestAnimationFrame(onFrame);\n\t\t\t\treturn () => {\n\t\t\t\t\tcanceled = true;\n\t\t\t\t};\n\t\t\t}\n\t\t}, [corePlayer, disabled]);\n\n\t\tuseEffect(() => {\n\t\t\tif (playing !== undefined) {\n\t\t\t\tif (playing) {\n\t\t\t\t\tcorePlayer?.resume();\n\t\t\t\t} else {\n\t\t\t\t\tcorePlayer?.pause();\n\t\t\t\t}\n\t\t\t} else corePlayer?.resume();\n\t\t}, [corePlayer, playing]);\n\n\t\tuseEffect(() => {\n\t\t\tif (alignAnchor !== undefined) corePlayer?.setAlignAnchor(alignAnchor);\n\t\t}, [corePlayer, alignAnchor]);\n\n\t\tuseEffect(() => {\n\t\t\tif (hidePassedLines !== undefined)\n\t\t\t\tcorePlayer?.setHidePassedLines(hidePassedLines);\n\t\t}, [corePlayer, hidePassedLines]);\n\n\t\tuseEffect(() => {\n\t\t\tif (alignPosition !== undefined)\n\t\t\t\tcorePlayer?.setAlignPosition(alignPosition);\n\t\t}, [corePlayer, alignPosition]);\n\n\t\tuseEffect(() => {\n\t\t\tif (enableSpring !== undefined) corePlayer?.setEnableSpring(enableSpring);\n\t\t\telse corePlayer?.setEnableSpring(true);\n\t\t}, [corePlayer, enableSpring]);\n\n\t\tuseEffect(() => {\n\t\t\tif (enableScale !== undefined) corePlayer?.setEnableScale(enableScale);\n\t\t\telse corePlayer?.setEnableScale(true);\n\t\t}, [corePlayer, enableScale]);\n\n\t\tuseEffect(() => {\n\t\t\tcorePlayer?.setEnableBlur(enableBlur ?? true);\n\t\t}, [corePlayer, enableBlur]);\n\n\t\tuseEffect(() => {\n\t\t\tif (currentTime !== undefined) {\n\t\t\t\tcorePlayer?.setCurrentTime(currentTime);\n\t\t\t\tcurrentTimeRef.current = currentTime;\n\t\t\t} else corePlayer?.setCurrentTime(0);\n\t\t}, [corePlayer, currentTime]);\n\n\t\tuseEffect(() => {\n\t\t\tcorePlayer?.setIsSeeking(!!isSeeking);\n\t\t}, [corePlayer, isSeeking]);\n\n\t\tuseEffect(() => {\n\t\t\tcorePlayer?.setWordFadeWidth(wordFadeWidth);\n\t\t}, [corePlayer, wordFadeWidth]);\n\n\t\tuseEffect(() => {\n\t\t\tif (linePosXSpringParams !== undefined)\n\t\t\t\tcorePlayer?.setLinePosXSpringParams(linePosXSpringParams);\n\t\t}, [corePlayer, linePosXSpringParams]);\n\n\t\tuseEffect(() => {\n\t\t\tif (linePosYSpringParams !== undefined)\n\t\t\t\tcorePlayer?.setLinePosYSpringParams(linePosYSpringParams);\n\t\t}, [corePlayer, linePosYSpringParams]);\n\n\t\tuseEffect(() => {\n\t\t\tif (lineScaleSpringParams !== undefined)\n\t\t\t\tcorePlayer?.setLineScaleSpringParams(lineScaleSpringParams);\n\t\t}, [corePlayer, lineScaleSpringParams]);\n\n\t\tuseEffect(() => {\n\t\t\tif (onLyricLineClick) {\n\t\t\t\tconst handler = (e: Event) =>\n\t\t\t\t\tonLyricLineClick(e as LyricLineMouseEvent);\n\t\t\t\tcorePlayer?.addEventListener(\"line-click\", handler);\n\t\t\t\treturn () => corePlayer?.removeEventListener(\"line-click\", handler);\n\t\t\t}\n\t\t}, [corePlayer, onLyricLineClick]);\n\n\t\tuseEffect(() => {\n\t\t\tif (onLyricLineContextMenu) {\n\t\t\t\tconst handler = (e: Event) =>\n\t\t\t\t\tonLyricLineContextMenu(e as LyricLineMouseEvent);\n\t\t\t\tcorePlayer?.addEventListener(\"line-contextmenu\", handler);\n\t\t\t\treturn () =>\n\t\t\t\t\tcorePlayer?.removeEventListener(\"line-contextmenu\", handler);\n\t\t\t}\n\t\t}, [corePlayer, onLyricLineContextMenu]);\n\n\t\tuseImperativeHandle(\n\t\t\tref,\n\t\t\t() => ({\n\t\t\t\twrapperEl: wrapperRef.current,\n\t\t\t\tlyricPlayer: corePlayer,\n\t\t\t}),\n\t\t\t[corePlayer],\n\t\t);\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<div {...props} ref={wrapperRef} />\n\t\t\t\t{corePlayer?.getBottomLineElement() && bottomLine\n\t\t\t\t\t? createPortal(bottomLine, corePlayer?.getBottomLineElement())\n\t\t\t\t\t: null}\n\t\t\t</>\n\t\t);\n\t},\n);\n"],"names":["BackgroundRender","forwardRef","album","albumIsVideo","fps","playing","flowSpeed","renderScale","staticMode","lowFreqVolume","hasLyric","renderer","style","props","ref","coreBGRenderRef","useRef","wrapperRef","lastRendererRef","curRenderer","MeshGradientRenderer","useEffect","CoreBackgroundRender","el","useImperativeHandle","jsx","LyricPlayer","disabled","alignAnchor","alignPosition","enableSpring","enableBlur","enableScale","hidePassedLines","lyricLines","currentTime","isSeeking","wordFadeWidth","linePosXSpringParams","linePosYSpringParams","lineScaleSpringParams","bottomLine","lyricPlayer","onLyricLineClick","onLyricLineContextMenu","corePlayer","setCorePlayer","useState","currentTimeRef","useLayoutEffect","newPlayer","DefaultLyricPlayer","canceled","lastTime","onFrame","time","handler","e","jsxs","Fragment","createPortal"],"mappings":"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"}